Using Apple as an external Identity Provider involves multiple steps at the Apple Developer Portal. These steps assume that you already have a [standard Apple developer account](https://developer.apple.com/).


??add note about applie info on Sign in with Apple? https://help.apple.com/developer-account/#/devde676e696??


## Create an App ID

??note here about in case Apple's UI or steps have changed, see Apple's documentation? (https://developer.apple.com/sign-in-with-apple/get-started/)??

1. Access your account's [Apple Developer Dashboard](https://developer.apple.com/).

2. From the left navigation, click **Certificates, IDs, & Profiles**.

3. From the left, select **Identifiers** and then click the blue plus icon to add an Identity Provider.

4. Select **App IDs** if it isn't already selected and click **Continue**. An App ID enables your app to access available services and identifies your app in a provisioning profile with Apple.

5. Enter a description and a Bundle ID for the App ID. Apple recommends using a reverse-domain name style string for the Bundle ID (for example, if the domain the app runs on is `example.com`, then enter `com.example` as the Bundle ID.)

    > **Note:** You can't edit this identifier after you create it, you can only remove it and create a new one.

6. Scroll down and select the **Sign In with Apple** check box.

7. Click **Continue** and then **Register**.

## Create a Services ID

1. Create another identifier, this time selecting **Services IDs**. The Services ID identifies the particular instance of your app and it's identifier is used as the OAuth `client_id`.

2. After you click **Continue**, enter a name for the app in the **Description** box. This is what the user sees during sign-in.

3. In the **Identifier** box, enter the identifier in a reverse-domain name style string. This identifier becomes the OAuth `client_id`.

4. Click **Continue** and then **Register**.

5. On the **Identifiers** page, select the identifier that you just created.

6. Scroll down and select the **Sign In with Apple** check box, and then click **Configure** to define the domain your app is running on and the redirect URLs used during the OAuth flow.

7. If it isn't already selected, select the App ID that you just created from the **Primary App ID** drop-down box.

8. Enter the domain name where your app runs in the **Domains and Subdomains** box. Be sure to enter a real domain. Domains such as `localhost` or IP addresses such as `127.0.0.1` won't work.

6. In the **Return URLs** box, enter (??a placeholder?? for) the redirect URL where you want to redirect users after successfully signing in to your website.

7. Click **Next**, **Done**, **Continue**, and then **Save**.

## Create a Private Key for Client Authentication

Apple uses a public/private key pair as the client secret. Register a new private key with Apple. ??You use this key to sign the JWT that you create??

1. On the **Certificates, Identifiers, & Profiles** page, select **Keys** and then **Create a key**.

2. Give your key a name, select the **Sign In with Apple** check box, and click **Configure**.

3. Select your App ID from the **Primary App ID** drop-down box and click **Save**. Apple generates a new private key.

4. Click **Continue** and then **Register**.

5. Click **Download**. The file that you download has a `.p8` extension.

    > **Important:** Make sure that you save the downloaded key file because you can't get it back later. Apple removes the server copy, so you can only download the key file once.

6. Click **Done**.

7. On the **Keys** page, click the key that you just created to obtain the Key ID that you need in the next step.

## Generate the Client Secret

Apple requires that you derive a client secret yourself from the private key that you downloaded from Apple Developer. Create a JSON Web Token (JWT) using the ES256 JWT algorithm (an elliptic curve algorithm with a P-256 curve and SHA256 hash).

> **Note:** See the **Creating the Client Secret** section on Apple's [Generate and validate tokens](https://developer.apple.com/documentation/sign_in_with_apple/generate_and_validate_tokens) page.

You need the following information to create the JWT header and payload:

Header

* `alg` &mdash; The algorithm used to sign the token, which is ES256.
* `kid` &mdash; The 10 alphanumeric character ID generated by Apple when you created the Key.

Example

```JSON
{
    "alg": "ES256",
    "kid": "UJ66XZ6J6S"
}
```

Payload

* `iss` &mdash; The issuer of the token. This value must be the 10 alphanumeric character Team ID from your Apple developer account. This can be found in the upper-right corner of your Apple developer dashboard just below your account name.
* `iat` &mdash; The issuing time of the generated client secret in seconds since January 1, 1970 UTC (current UNIX timestamp)
* `exp` &mdash; The expiration time of client secret in seconds since January 1, 1970 UTC (current UNIX timestamp). The value must not be greater than 15777000 (6 months in seconds) from the current UNIX timestamp on the server.
* `aud` &mdash; The full URL of the resource (recipient) that you're using the client secret to authenticate to. Since the client secret is sent to the validation server, use: `https://appleid.apple.com`.
* `sub` &mdash; The subject of the client secret. Since this client secret is meant for your application, use the identifier that you created when you created the Services ID (the reverse-domain name style string), which is also used as the OAuth `client_id`.

* Key file &mdash; The file that you downloaded from Apple

Example

```JSON
{
    "iss": "B85HZJH7U3",
    "iat": "1437179036",
    "exp": "1493298100",
    "aud": "https://appleid.apple.com",
    "sub": "com.writesharper.login.client"
}
```

