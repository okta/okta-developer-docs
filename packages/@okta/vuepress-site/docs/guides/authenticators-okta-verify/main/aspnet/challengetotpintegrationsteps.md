#### 1. Start challenge, retrieve and display a list of authenticators

The user signs in with a username and password, and then chooses Okta Verify from a list of authenticators. This is covered in the earlier [Shared Code](#initiate-sign-in-and-return-a-list-of-authenticators) section.

#### 2 - 3. Retrieve and display a list of challenge methods

When the user selects Okta Verify and clicks **Submit**, the form posts back to the `SelectAuthenticatorAsync` method. In challenge flow, a list of available challenge methods is retrieved and presented to the user.

The code for this is shared with Steps 2 and 3 of [Integrate Challenge using push notification](#integrate-challenge-using-push-notification-option).

#### 4. Initiate authentication on server-side

When the user selects the challenge method type and clicks **Submit**, the challenge process is initiated on the server-side with a call to `SelectChallengeAuthenticatorAsync`, and the user is redirected to the page specific to that challenge method. In this case, to a page prompting the user to enter the TOTP generated by Okta Verify.

The code for this is shared with Step 4 of [Integrate Challenge using push notification](#integrate-challenge-using-push-notification-option).

#### 5. Prompt user to use Okta Verify

Build a page that allows the user to enter the TOTP they have received from Okta Verify.

```razor
<div>
    @using (Html.BeginForm("EnterCodeAsync", "OktaVerify",
        FormMethod.Post, new { role = "form" }))
    {
        @Html.AntiForgeryToken()
        <h4>Enter a code</h4>
        @Html.ValidationSummary("", new { @class = "text-danger" })
        <div>
            <div>
                @Html.LabelFor(m => m.Code)
                @Html.EditorFor(m => m.Code)
            </div>
        </div>
        <div>
            <div>
                <input type="submit" value="Submit" />
            </div>
        </div>
    }
</div>
```

The user sees the following:

<div class="common-image-format bordered-image">

![A page asking the user to enter a time-based one-time passcode from their Okta Verify mobile app](/img/authenticators/dotnet-authenticators-okta-verify-challenge-enter-totp.png "A prompt for the user to enter their TOTP")

</div>

#### 6. User retrieves TOTP from Okta Verify

The user opens Okta Verify on their device, copies the TOTP that appears into the challenge box and clicks **Submit**.

#### 7. Process the TOTP

Create a `OktaVerifyVerifyAuthenticatorOptions` object and set its `TotpCode` property to the password entered by the user. Pass this object as a parameter to the `IdxClient.VerifyAuthenticatorAsync` method.

```csharp
var verifyAuthenticatorOptions = new OktaVerifyVerifyAuthenticatorOptions
{
   TotpCode = oktaVerifyEnterCodeModel.Code,
};

try
{
   var authenticationResponse = await _idxClient.VerifyAuthenticatorAsync(
      verifyAuthenticatorOptions, (IIdxContext)Session["idxContext"]);
```

Query the `AuthenticationStatus` property of the `AuthenticationResponse` object returned by `VerifyAuthenticatorAsync` to discover the current status of the authentication process. You should expect one of the following statuses

* **Success** : The user signed in successfully.
* **PasswordExpired** : The user needs to change their password.
* **AwaitingChallengeAuthenticatorSelection** : The user authenticated successfully with Okta Verify and must now authenticate themselves with a different factor.

```csharp
switch (authenticationResponse?.AuthenticationStatus)
{
    case AuthenticationStatus.Success:
        ClaimsIdentity identity = await AuthenticationHelper.GetIdentityFromTokenResponseAsync(_idxClient.Configuration, authenticationResponse.TokenInfo);
        _authenticationManager.SignIn(new AuthenticationProperties(), identity);
        return RedirectToAction("Index", "Home");
    case AuthenticationStatus.PasswordExpired:
        return RedirectToAction("ChangePassword", "Manage");
    case AuthenticationStatus.AwaitingChallengeAuthenticatorSelection:
        Session["authenticators"] = ViewModelHelper.ConvertToAuthenticatorViewModelList(authenticationResponse.Authenticators);
        Session["isChallengeFlow"] = true;
        return RedirectToAction("SelectAuthenticator", "Manage");
    default:
        return View("Login");
}
```

#### 8. Complete challenge and sign user in

On success, call `AuthenticationHelper.GetIdentityFromTokenResponseAsync` to retrieve the OIDC claims information about the user and pass them into your application. The user is now signed in.
