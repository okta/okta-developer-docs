(window.webpackJsonp=window.webpackJsonp||[]).push([[1487],{1231:function(t,a,s){"use strict";s.r(a);var e=s(8),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"okta-asp-net-web-api-quickstart"}},[t._v("Okta ASP.NET Web API Quickstart "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#okta-asp-net-web-api-quickstart","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("If you want a full, working example, head over to the "),s("a",{attrs:{href:"https://github.com/okta/samples-aspnet/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ASP.NET examples"),s("OutboundLink")],1),t._v(" and follow the "),s("code",[t._v("README")]),t._v(" instructions.")]),t._v(" "),s("h3",{attrs:{id:"create-a-new-web-api-project"}},[t._v("Create a new Web API project "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#create-a-new-web-api-project","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("If you don't already have a Web API project, create a new ASP.NET (.NET Framework) project and choose the Web API template. Choose "),s("strong",[t._v("No Authentication")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"install-required-packages"}},[t._v("Install required packages "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#install-required-packages","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("First, install these packages with NuGet:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://nuget.org/packages/Okta.AspNet",target:"_blank",rel:"noopener noreferrer"}},[t._v("Okta.AspNet"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.nuget.org/packages/Microsoft.Owin.Host.SystemWeb",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microsot.Owin.Host.SystemWeb"),s("OutboundLink")],1),t._v(" 4.0.0 or higher")])]),t._v(" "),s("h3",{attrs:{id:"configure-the-middleware"}},[t._v("Configure the middleware "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#configure-the-middleware","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("If you don't already have a "),s("code",[t._v("Startup.cs")]),t._v(" file (OWIN Startup class), create one by right-clicking on your project and choosing "),s("strong",[t._v("Add")]),t._v(" > "),s("strong",[t._v("OWIN Startup Class")]),t._v(".")]),t._v(" "),s("p",[t._v("Make sure you have these "),s("code",[t._v("using")]),t._v(" statements at the top of your "),s("code",[t._v("Startup.cs")]),t._v(" file:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" Microsoft"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Owin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" Okta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AspNet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" Owin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Add the following code to your "),s("code",[t._v("Configuration")]),t._v(" method:\n"),s("DomainAdminWarning")],1),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IAppBuilder")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseOktaWebApi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OktaWebApiOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        OktaDomain "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ConfigurationManager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AppSettings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"okta:OktaDomain"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"additional-middleware-configuration"}},[t._v("Additional middleware configuration "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#additional-middleware-configuration","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("OktaWebApiOptions")]),t._v(" class configures the Okta middleware. You can see all the available options in the "),s("a",{attrs:{href:"https://github.com/okta/okta-aspnet/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Okta ASP.NET middleware GitHub"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"configure-the-project"}},[t._v("Configure the project "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#configure-the-project","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("Open the "),s("code",[t._v("Web.config")]),t._v(" file and add your Okta configuration to the "),s("code",[t._v("<appSettings>")]),t._v(" section.\nCheck out the "),s("a",{attrs:{href:"https://github.com/okta/okta-aspnet/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Okta ASP.NET middleware GitHub"),s("OutboundLink")],1),t._v(" to see more details about this step.")]),t._v(" "),s("h3",{attrs:{id:"protect-application-resources"}},[t._v("Protect application resources "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#protect-application-resources","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("Use the "),s("code",[t._v("[Authorize]")]),t._v(" attribute on API controllers or actions to require an authenticated user. For example, create an "),s("code",[t._v("/api/messages")]),t._v(" route in a new API controller that returns secret messages if a token is present:")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Collections"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Generic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Security"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Claims"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Web"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Authorize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessagesController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApiController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"~/api/messages"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IHttpActionResult")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" principal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Principal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Identity")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ClaimsIdentity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" login "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" principal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Claims\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SingleOrDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdentityModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Claims"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClaimTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NameIdentifier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?.")]),t._v("Value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            messages "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("dynamic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" date "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DateTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I am a Robot."')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" date "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DateTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, world!"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"that-s-it"}},[t._v("That's it! "),s("a",{staticClass:"header-anchor header-link",attrs:{href:"#that-s-it","aria-hidden":"true"}},[s("i",{staticClass:"fa fa-link"})])]),t._v(" "),s("p",[t._v("The Okta middleware automatically validates tokens and populates "),s("code",[t._v("HttpContext.User")]),t._v(" with a limited set of user information.")]),t._v(" "),s("p",[t._v("If you want to do more with the user, you can use the "),s("a",{attrs:{href:"https://github.com/okta/okta-sdk-dotnet",target:"_blank",rel:"noopener noreferrer"}},[t._v("Okta .NET SDK"),s("OutboundLink")],1),t._v(" to get or update the user's details stored in Okta.")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("Note:")]),t._v(" If your client application is running on a different server (or port) than your ASP.NET Core server, you'll need to add "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/aspnet/core/security/cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS middleware"),s("OutboundLink")],1),t._v(" to the pipeline as well. Check out our "),s("a",{attrs:{href:"https://github.com/okta/samples-aspnet/tree/master/resource-server",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("resource server")]),t._v(" sample"),s("OutboundLink")],1),t._v(" which is pre-configured with an open CORS policy to make it easy to test with frontend projects!")])])])}),[],!1,null,null,null);a.default=n.exports}}]);